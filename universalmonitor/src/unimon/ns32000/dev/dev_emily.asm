;;;
;;;	EMILY Board Console Driver
;;;

	INCLUDE	"../../emily.inc"

INIT:
	MOVB	00H,R0
	MOVB	R0,@SMBASE+EO_HSK
	MOVB	R0,@SMBASE+EO_CMD ; Command

	MOVB	0A5H,@SMBASE+EO_SIG ; Signature

	MOVB	0CCH,@SMBASE+EO_HSK ; Handshake

	RET

CONIN:
	CMPB	0CCH,@SMBASE+EO_HSK
	BEQ	CONIN

	MOVB	EC_CIN,@SMBASE+EO_CMD

	MOVB	0CCH,@SMBASE+EO_HSK
CI1:
	CMPB	0CCH,@SMBASE+EO_HSK
	BEQ	CI1

	MOVB	@SMBASE+EO_DAT,R0

	RET
	
CONST:
	CMPB	0CCH,@SMBASE+EO_HSK
	BEQ	CONST

	MOVB	EC_CST,@SMBASE+EO_CMD

	MOVB	0CCH,@SMBASE+EO_HSK
CS1:
	CMPB	0CCH,@SMBASE+EO_HSK
	BEQ	CS1

	MOVB	@SMBASE+EO_DAT,R0
	RET

CONOUT:
	CMPB	0CCH,@SMBASE+EO_HSK
	BEQ	CONOUT

	MOVB	EC_COT,@SMBASE+EO_CMD

	MOVB	R0,@SMBASE+EO_DAT

	MOVB	0CCH,@SMBASE+EO_HSK

	RET
