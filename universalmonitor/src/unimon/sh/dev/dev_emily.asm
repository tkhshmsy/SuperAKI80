;;;
;;;	EMILY Board Console Driver
;;;

	INCLUDE	"../../emily.inc"

PACRL1:	EQU	$FFFF838C	;
PACRL2:	EQU	$FFFF838E	;

INIT:
	;; Initialize PFC (Pin Function Controller)
	MOV.L	#PACRL1,R13
	MOV.W	#PACRL1_V,R14
	MOV.W	R14,@R13
	MOV.L	#PACRL2,R13
	MOV.W	#PACRL2_V,R14
	MOV.W	R14,@R13

	MOV.L	#SMBASE,R14

	XOR	R0,R0
	MOV.B	R0,@(EO_HSK,R14)
	MOV.B	R0,@(EO_CMD,R14)

	MOV.B	#EG_SIG,R0
	MOV.B	R0,@(EO_SIG,R14)

	MOV.B	#EH_REQ,R0
	MOV.B	R0,@(EO_HSK,R14)

	RTS
	NOP

CONIN:
	MOV.L	#SMBASE,R14
CI0:
	MOV.B	@(EO_HSK,R14),R0
	MOV.B	#EH_REQ,R1
	CMP/EQ	R1,R0
	BT	CI0

	MOV.B	#EC_CIN,R0
	MOV.B	R0,@(EO_CMD,R14)

	MOV	R1,R0		; EH_REQ
	MOV.B	R0,@(EO_HSK,R14)
CI1:
	MOV.B	@(EO_HSK,R14),R0
	CMP/EQ	R1,R0
	BT	CI1

	MOV.B	@(EO_DAT,R14),R0

	RTS
	NOP

CONST:
	MOV.L	#SMBASE,R14
CS0:
	MOV.B	@(EO_HSK,R14),R0
	MOV.B	#EH_REQ,R1
	CMP/EQ	R1,R0
	BT	CS0

	MOV.B	#EC_CST,R0
	MOV.B	R0,@(EO_CMD,R14)

	MOV	R1,R0		; EH_REQ
	MOV.B	R0,@(EO_HSK,R14)
CS1:
	MOV.B	@(EO_HSK,R14),R0
	CMP/EQ	R1,R0
	BT	CS1

	MOV.B	@(EO_DAT,R14),R0

	RTS
	NOP

CONOUT:
	MOV.L	#SMBASE,R14
	MOV	R0,@-R15
CO0:
	MOV.B	@(EO_HSK,R14),R0
	MOV.B	#EH_REQ,R1
	CMP/EQ	R1,R0
	BT	CO0

	MOV.B	#EC_COT,R0
	MOV.B	R0,@(EO_CMD,R14)

	MOV	@R15+,R0
	MOV.B	R0,@(EO_DAT,R14)

	MOV	R1,R0		; EH_REQ
	MOV.B	R0,@(EO_HSK,R14)

	RTS
	NOP

	LTORG
