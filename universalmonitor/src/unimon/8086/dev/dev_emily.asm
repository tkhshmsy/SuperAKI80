;;;
;;; 	EMILY Board Console Driver (for 8086)
;;;

	INCLUDE	"../../emily.inc"

INIT:
	IF SMSEG <> RAMSEG
	PUSH	DS
	MOV	AX,SMSEG
	MOV	DS,AX
	ENDIF

	MOV	AL,EC_INI
	MOV	[SMBASE+EO_HSK],AL
	MOV	[SMBASE+EO_CMD],AL

	MOV	AL,0A5H
	MOV	[SMBASE+EO_SIG],AL

	MOV	AL,0CCH
	MOV	[SMBASE+EO_HSK],AL

	IF SMSEG <> RAMSEG
	POP	DS
	ENDIF

	RET

CONIN:
	IF SMSEG <> RAMSEG
	PUSH	DS
	MOV	AX,SMSEG
	MOV	DS,AX
	ENDIF

CI0:	
	MOV	AL,[SMBASE+EO_HSK]
	CMP	AL,0CCH
	JE	CI0
	
	MOV	AL,EC_CIN
	MOV	[SMBASE+EO_CMD],AL
	
	MOV	AL,0CCH
	MOV	[SMBASE+EO_HSK],AL
CI1:
	MOV	AL,[SMBASE+EO_HSK]
	CMP	AL,0CCH
	JE	CI1

	MOV	AL,[SMBASE+EO_DAT]

	IF SMSEG <> RAMSEG
	POP	DS
	ENDIF

	RET

CONST:
	IF SMSEG <> RAMSEG
	PUSH	DS
	MOV	AX,SMSEG
	MOV	DS,AX
	ENDIF

CS0:	
	MOV	AL,[SMBASE+EO_HSK]
	CMP	AL,0CCH
	JE	CS0
	
	MOV	AL,EC_CST
	MOV	[SMBASE+EO_CMD],AL
	
	MOV	AL,0CCH
	MOV	[SMBASE+EO_HSK],AL
CS1:
	MOV	AL,[SMBASE+EO_HSK]
	CMP	AL,0CCH
	JE	CS1

	MOV	AL,[SMBASE+EO_DAT]

	IF SMSEG <> RAMSEG
	POP	DS
	ENDIF

	RET

CONOUT:
	PUSH	AX

	IF SMSEG <> RAMSEG
	PUSH	DS
	MOV	AX,SMSEG
	MOV	DS,AX
	ENDIF

CO0:
	MOV	AL,[SMBASE+EO_HSK]
	CMP	AL,0CCH
	JE	CO0

	MOV	AL,EC_COT
	MOV	[SMBASE+EO_CMD],AL

	POP	AX
	MOV	[SMBASE+EO_DAT],AL

	MOV	AL,0CCH
	MOV	[SMBASE+EO_HSK],AL

	IF SMSEG <> RAMSEG
	POP	DS
	ENDIF

	RET

