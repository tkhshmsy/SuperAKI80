;;;
;;;	EMILY Board Console Driver
;;;

	INCLUDE	"../../emily.inc"

INIT:
	XOR.B	R0,R0
	MOV.B	R0,@SMBASE+EO_HSK
	MOV.B	R0,@SMBASE+EO_CMD

	MOV.B	#EG_SIG,R0
	MOV.B	R0,@SMBASE+EO_SIG

	MOV.B	#EH_REQ,R0
	MOV.B	R0,@SMBASE+EO_HSK

	RTS
	
CONIN:
	MOV.B	@SMBASE+EO_HSK,R0
	CMP.B	#EH_REQ,R0
	BEQ	CONIN

	MOV.B	#EC_CIN,R0
	MOV.B	R0,@SMBASE+EO_CMD

	MOV.B	#EH_REQ,R0
	MOV.B	R0,@SMBASE+EO_HSK
CI0:
	MOV.B	@SMBASE+EO_HSK,R0
	CMP.B	#EH_REQ,R0
	BEQ	CI0

	MOV.B	SMBASE+EO_DAT,R0

	RTS

CONST:
	MOV.B	@SMBASE+EO_HSK,R0
	CMP.B	#EH_REQ,R0
	BEQ	CONST

	MOV.B	#EC_CST,R0
	MOV.B	R0,@SMBASE+EO_CMD

	MOV.B	#EH_REQ,R0
	MOV.B	R0,@SMBASE+EO_HSK
CS0:
	MOV.B	@SMBASE+EO_HSK,R0
	CMP.B	#EH_REQ,R0
	BEQ	CS0

	MOV.B	@SMBASE+EO_DAT,R0

	RTS

CONOUT:
	MOV	R0,@-SP
CO0:	
	MOV.B	@SMBASE+EO_HSK,R0
	CMP.B	#EH_REQ,R0
	BEQ	CO0

	MOV.B	#EC_COT,R0
	MOV.B	R0,@SMBASE+EO_CMD

	MOV	@SP+,R0
	MOV.B	R0,@SMBASE+EO_DAT
	MOV	R0,@-SP

	MOV.B	#EH_REQ,R0
	MOV.B	R0,@SMBASE+EO_HSK

	MOV	@SP+,R0
	RTS

